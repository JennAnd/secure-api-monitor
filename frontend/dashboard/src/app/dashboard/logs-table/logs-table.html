<div class="logs-wrapper">
  <h2>API Logs</h2>

  <div class="logs-filters">
    <!-- Filter by endpoint -->
    <label>
      Endpoint:
      <input
        type="text"
        [(ngModel)]="endpointFilter"
        (ngModelChange)="applyFilters()"
        placeholder="/api/auth"
      />
    </label>

    <!-- Filter by status code -->
    <label>
      Status:
      <input
        type="number"
        [(ngModel)]="statusFilter"
        (ngModelChange)="applyFilters()"
        placeholder="200"
      />
    </label>

    <!-- Filter by date range -->
    <label>
      From:
      <input type="date" [(ngModel)]="dateFrom" (ngModelChange)="applyFilters()" />
    </label>

    <label>
      To:
      <input type="date" [(ngModel)]="dateTo" (ngModelChange)="applyFilters()" />
    </label>
  </div>

  <!-- Loading spinner text -->
  <p *ngIf="isLoading">Loading logs...</p>

  <!-- Error message -->
  <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>

  <!-- If logs exist, show the material table -->
  <table
    mat-table
    [dataSource]="filteredLogs"
    class="mat-elevation-z2"
    *ngIf="filteredLogs.length > 0"
  >
    <!-- Timestamp -->
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef>Timestamp</th>
      <td mat-cell *matCellDef="let log">{{ log.timestamp }}</td>
    </ng-container>

    <!-- Method -->
    <ng-container matColumnDef="method">
      <th mat-header-cell *matHeaderCellDef>Method</th>
      <td mat-cell *matCellDef="let log">{{ log.method }}</td>
    </ng-container>

    <!-- Endpoint -->
    <ng-container matColumnDef="endpoint">
      <th mat-header-cell *matHeaderCellDef>Endpoint</th>
      <td mat-cell *matCellDef="let log">{{ log.endpoint }}</td>
    </ng-container>

    <!-- Status -->
    <ng-container matColumnDef="statusCode">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td
        mat-cell
        *matCellDef="let log"
        [class.status-success]="log.statusCode >= 200 && log.statusCode < 300"
        [class.status-client-error]="log.statusCode >= 400 && log.statusCode < 500"
        [class.status-server-error]="log.statusCode >= 500"
      >
        {{ log.statusCode }}
      </td>
    </ng-container>

    <!-- Response Time -->
    <ng-container matColumnDef="responseTimeMs">
      <th mat-header-cell *matHeaderCellDef>Time (ms)</th>
      <td mat-cell *matCellDef="let log">{{ log.responseTimeMs }}</td>
    </ng-container>

    <!-- Header & row defs -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <!-- If no logs -->
  <p *ngIf="!isLoading && filteredLogs.length === 0">No logs found.</p>
</div>
